<!DOCTYPE html>
<html lang="uk">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <title>testisquitcc</title>

  <link rel="stylesheet" href="header_styles.css">
  <link rel="icon" href="favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="favicon.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="–ù–∞–∑–≤–∞–î–æ–¥–∞—Ç–∫—É">
  <link rel="manifest" href="manifest.json">
  <style>
    /* Toast container */
    #toast-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 9999;
    }
    .toast {
      background: rgba(0,0,0,0.8);
      color: #fff;
      padding: 12px 16px;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
      max-width: 300px;
      animation: fadein 0.3s;
    }
    .toast button {
      margin-top: 8px;
      padding: 6px 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .toast .confirm-btn {
      background: #4CAF50;
      color: #fff;
    }
    @keyframes fadein { from { opacity: 0; transform: translateY(10px);} to { opacity: 1; transform: translateY(0);} }

    /* Form styles */
    #cancel-btn { background: #e0e0e0; }
    #save-task-btn { background: #4CAF50; color: white; }

    /* Archive hidden */
    #archive-container { display: none; margin-top: 20px; }
    #archive-container.visible { display: block; }

    /* Task card */
    .task-card { border: 1px solid #ddd; border-radius: 8px; padding: 16px; max-width: 400px; background: #fff; box-shadow: 0 2px 6px rgba(0,0,0,0.05); margin-bottom: 20px; transition: opacity 0.2s; }
    .task-card.completed { opacity: 0.6; }
    .field { margin-bottom: 12px; }
    .value { padding-left: 8px; color: #555; line-height: 1.4; }
    .task-actions { display: flex; gap: 8px; justify-content: flex-end; margin-top: 12px; }
    .delete-btn, .complete-btn, .success-btn { padding: 6px 12px; font-size: 14px; border: none; border-radius: 6px; cursor: pointer; }
    .delete-btn { background: #e0e0e0; }
    .complete-btn { background: #4CAF50; color: white; }
    .success-btn { background: #2196F3; color: white; cursor: default; }
  </style>
</head>
<body>
  <div class="nav-bar">
    <button onclick="location.href='index.html'"><div class="icon">‚úçÔ∏è</div><div class="label">–ó–∞–ø–∏—Å–∏</div></button>
    <button onclick="location.href='task.html'"><div class="icon">üìú</div><div class="label">–¶—ñ–ª—ñ</div></button>
    <button onclick="location.href='habits.html'"><div class="icon">üìÖ</div><div class="label">–ó–≤–∏—á–∫–∏</div></button>
    <button onclick="location.href='history.html'"><div class="icon">üìñ</div><div class="label">–Ü—Å—Ç–æ—Ä—ñ—è</div></button>
  </div>

  <button id="add-task-btn" style="margin-bottom:20px;">–î–æ–¥–∞—Ç–∏</button>

  <form id="task-form">
    <input type="text" id="title-input" autocomplete="off" placeholder="–ú–µ—Ç–∞" maxlength="30" required />
    <input type="text" id="trigger-input" autocomplete="off" placeholder="–¢—Ä–∏–≥–µ—Ä" />
    <textarea id="details-input" placeholder="–î–µ—Ç–∞–ª—ñ" rows="3" style="resize:none"></textarea>
    <div style="display:flex; gap:10px; justify-content:flex-end;">
      <button type="button" id="cancel-btn">–í—ñ–¥–º—ñ–Ω–∏—Ç–∏</button>
      <button type="submit" id="save-task-btn">–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è</button>
    </div>
  </form>

  <div id="task-container"></div>
  <h1 id="toggle-archive-btn" style="display:none; cursor:pointer;">–í—ñ–¥–æ–±—Ä–∞–∑–∏—Ç–∏ –∞—Ä—Ö—ñ–≤</h1>
  <div id="archive-container"></div>
  <div id="toast-container"></div>
<script>
  const STORAGE_KEY = 'taskListV3';
  const addBtn = document.getElementById('add-task-btn');
  const taskForm = document.getElementById('task-form');
  const titleInput = document.getElementById('title-input');
  const triggerInput = document.getElementById('trigger-input');
  const detailsInput = document.getElementById('details-input');
  const cancelBtn = document.getElementById('cancel-btn');
  const taskContainer = document.getElementById('task-container');
  const archiveContainer = document.getElementById('archive-container');
  const toggleArchiveBtn = document.getElementById('toggle-archive-btn');
  const toastContainer = document.getElementById('toast-container');

  addBtn.onclick = () => { taskForm.style.display = 'flex'; addBtn.disabled = true; titleInput.focus(); };
  cancelBtn.onclick = resetForm;

  function resetForm() {
    taskForm.style.display = 'none'; addBtn.disabled = false; titleInput.value = triggerInput.value = detailsInput.value = '';
  }

  function showToast(message, options = {}) {
  const toast = document.createElement('div');
  toast.className = 'toast';
  toast.innerHTML = message.split('\n').map(line => `<div>${line}</div>`).join('');

  const timeout = options.timeout || 5000;

  const remove = () => {
    if (toast.parentElement) toastContainer.removeChild(toast);
  };

  if (options.confirm) {
    const btn = document.createElement('button');
    btn.className = 'confirm-btn';
    btn.textContent = '–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏';
    btn.onclick = () => {
      options.onConfirm();
      remove();
    };
    toast.appendChild(btn);
  }

  // –ù–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –∫–Ω–æ–ø–æ–∫ ‚Äî –∑–Ω–∏–∫–∞—î —á–µ—Ä–µ–∑ timeout
  setTimeout(remove, timeout);

  toastContainer.appendChild(toast);
}


  function saveTasks() {
    const tasks = [], archived = [];
    document.querySelectorAll('.task-card').forEach(card => {
      const data = { goal: card.dataset.goal, trigger: card.dataset.trigger, details: card.dataset.details, archived: card.classList.contains('completed') };
      data.archived ? archived.push(data) : tasks.push(data);
    });
    localStorage.setItem(STORAGE_KEY, JSON.stringify({ tasks, archived }));
  }

  function loadTasks() {
    const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{"tasks":[],"archived":[]}');
    taskContainer.innerHTML = ''; archiveContainer.innerHTML = '';
    saved.tasks.forEach(d => appendCard(d, false));
    saved.archived.forEach(d => appendCard(d, true));
    updateArchiveButton();
  }

  function appendCard({ goal, trigger, details }, isArchived) {
    const card = renderTaskCard({ goal, trigger, details });
    if (isArchived) { card.classList.add('completed'); archiveContainer.appendChild(card); }
    else taskContainer.appendChild(card);
    updateArchiveButton();
  }

  function renderTaskCard({ goal, trigger, details }) {
  const card = document.createElement('div');
  card.className = 'task-card';
  card.dataset.goal = goal;
  card.dataset.trigger = trigger;
  card.dataset.details = details;

  const makeField = (label, text) => {
    const fld = document.createElement('div');
    fld.className = 'field';
    fld.innerHTML = `<div class="label">${label}</div><div class="value">${text}</div>`;
    return fld;
  };

  card.append(makeField('–ú–µ—Ç–∞:', goal), makeField('–¢—Ä–∏–≥–µ—Ä:', trigger), makeField('–î–µ—Ç–∞–ª—ñ:', details));

  const actions = document.createElement('div');
  actions.className = 'task-actions';

  const deleteBtn = document.createElement('button');
  deleteBtn.className = 'delete-btn';
  deleteBtn.textContent = '‚ùå';
  deleteBtn.onclick = () => {
    showToast('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ –±–∞–∂–∞—î—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –º–µ—Ç—É?', {
      confirm: true,
      onConfirm: () => {
        card.remove();
        saveTasks();
        updateArchiveButton();
      }
    });
  };

  const completeBtn = document.createElement('button');
  completeBtn.className = 'complete-btn';
  completeBtn.textContent = '–ü–æ–∑–Ω–∞—á–∏—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–∏–º';
  completeBtn.onclick = () => {
    card.classList.add('completed');
    archiveContainer.appendChild(card);
    saveTasks();
    updateArchiveButton();

    actions.querySelector('.delete-btn').style.display = 'inline-block';
    showToast('–í—ñ—Ç–∞—î–º–æ!\n–ó–∞–ø–∏—Å –ø–µ—Ä–µ–º—ñ—â–µ–Ω–æ –¥–æ –∞—Ä—Ö—ñ–≤—É');

    const successText = document.createElement('div');
    successText.textContent = '–£—Å–ø—ñ—Ö';
    successText.className = 'success-text';
    completeBtn.replaceWith(successText);
  };

  actions.append(deleteBtn, completeBtn);
  card.appendChild(actions);

  return card; // <--- –û—Å—å —Ü–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–æ
}


  function updateArchiveButton() {
    if (archiveContainer.children.length) toggleArchiveBtn.style.display = 'block';
    else { toggleArchiveBtn.style.display = 'none'; archiveContainer.classList.remove('visible'); }
  }

  toggleArchiveBtn.onclick = () => archiveContainer.classList.toggle('visible');

  taskForm.onsubmit = e => {
    e.preventDefault(); if (!titleInput.value.trim()) { alert('–í–≤–µ–¥—ñ—Ç—å –º–µ—Ç—É'); titleInput.focus(); return; }
    appendCard({ goal: titleInput.value.trim(), trigger: triggerInput.value.trim(), details: detailsInput.value.trim() }, false);
    saveTasks(); resetForm();
  };

  window.addEventListener('DOMContentLoaded', loadTasks);
</script>
</body>
</html>
